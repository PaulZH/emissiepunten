<link rel="import" href="../../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../ev-sparql-query/ev-sparql-query.html?1.1.0"/>
<dom-module id="sites-query">
<template>
<ev-sparql-query id="query" api="imjv" notify-map="true" results="{{response}}">
            SELECT DISTINCT ?site ?siteLabel (COUNT(DISTINCT ?ep) AS ?epCount) WHERE {
                SERVICE geo:search {
                    ?ep geo:search "inCircle";
                    geo:searchDatatype geoliteral:lat-lon ;
                    geo:predicate wgs84:lat_long;
                    geo:spatialCircleCenter "{{location.lat}}#{{location.lon}}";
                    geo:spatialCircleRadius "{{getQueryRadius(location.radius)}}" .
                }
                ?ep a milieu:Emissiepunt ;
                    milieu:exploitatie ?site .
                ?site rdfs:label ?siteLabel .
            }
            GROUP BY ?site ?siteLabel
        </ev-sparql-query>
</template>
<script>Polymer({is:"sites-query",properties:{response:{type:Object,notify:!0},location:{type:Object}},getQueryRadius:function(e){return e<=5?1.5*e:1.1*e},execute:function(){this.$.query.execute()}})</script>
</dom-module>