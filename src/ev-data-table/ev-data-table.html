<!-- elements -->
<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<!-- styles -->
<link rel="import" href="../app/app-styles.html"/>
<!-- behaviors -->
<link rel="import" href="../app/behaviors/app-term-labels.html"/>

<dom-module id="ev-data-table">

    <template>

        <style include="app-styles">
            table {
                border-collapse: collapse;
                width: 100%;
            }

            th {
                text-align: left;
                background-color: var(--ev-app-grey-7);
                font-family: "Flanders Sans", "Roboto-Light", sans-serif;
                font-weight: 300;
                line-height: 40px;
                padding: 1px 16px 0;
            }

            td {
                line-height: 32px;
                padding: 0 16px;
                font-size: 0.9em;
            }

            tr + tr td {
                border-top: 1px solid var(--ev-app-grey-7);
            }

            td.label {
                font-weight: 500;
                text-align: right;
                text-transform: capitalize;
            }
        </style>

        <table>
            <thead>
                <tr>
                    <th colspan="2">[[title]]</th>
                </tr>
            </thead>
            <tbody>
            <template is="dom-repeat" items="{{items}}">
                <tr>
                    <td class="label">{{item.name}}</td>
                    <td>{{item.value}}</td>
                </tr>
            </template>
            </tbody>
        </table>

    </template>

    <script>
        Polymer({

            is: 'ev-data-table',

            behaviors: [
                appTermLabels
            ],

            attached: function () {
            },

            properties: {
                /** term label mappings */
                termLabels: {
                    type: Object
                },
                /* table title */
                title: String,
                /* Resource data (raw) */
                data: {
                    type: Object,
                    observer: 'onData'
                },
                /* table items (processed table data) */
                items: {
                    type: Array,
                    value: null
                }
            },

            onData: function (data) {
                var self = this;
                var items = [];
                data.bindings.forEach(function (binding) {
                    var pLabel, oLabel;
                    pLabel = self.getTermLabel(binding.p.value);

                    if (binding.p.value === 'http://purl.org/dc/terms/type') {// special: type has a term as value
                        oLabel = self.getTermLabel(binding.o.value);
                    } else if (binding.o.type === 'uri' || binding.o.type === 'bnode') {// skip links
                        return;
                    } else if (binding.p.value.match(/[#\/](lambert.*|lat|long|lat_long)$/i)) {// skip geo fields
                        return;
                    } else {// keep literal fields
                        oLabel = binding.o.value;
                    }
                    items.push({name: pLabel, value: oLabel })
                });
                this.set('items', items);
            }
        });
    </script>

</dom-module>
